<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Magic Mirror Project - Group 7</title>
    <link rel="stylesheet" href="style/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/addons/p5.dom.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://platform.twitter.com/widgets.js"></script>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-analytics.js"></script>
    <!-- Remember to include jQuery :) -->
    <!-- jQuery Modal -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css">
</head>
<body>
<div id="timeline" style="display: none"></div>
<div id="ex1" class="modal">
    <p>Time format: <b>24</b> | 12 hour</p>
    <p>Region: US</p>
    <a href="#" rel="modal:close">Close</a>
</div>

<!-- Link to open the modal -->
<a href="#ex1" rel="modal:open">
    <i style="position: absolute;
 bottom: 10px;
 right: 10px;
color: black"
       class="fas fa-cogs fa-3x"></i></a>

<div class="pie pie1" onclick="document.body.classList.remove('active')">
    <div class="pie-color pie-color1">
        <svg class="card" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100">
            <path
                    d="M99.98 27.38c0-7.597-6.18-13.777-13.78-13.777H13.78C6.18 13.603 0 19.783 0 27.38v45.842C0 80.82 6.18 87 13.778 87H86.2c7.6 0 13.8-6.18 13.8-13.778v-45.84zm-92.678 0c0-3.555 2.9-6.433 6.455-6.433H86.18c3.555 0 6.455 2.878 6.455 6.434v4.213H7.302zM86.18 79.657H13.757c-3.556 0-6.455-2.9-6.455-6.434V44.185h85.312v29.037c.02 3.556-2.88 6.434-6.434 6.434zM23.852 60.82s-3.725-.973-4.466-1.122c-.783-.19-.867-.635-.867-1.015v-.424c0-.255.02-.51.23-.72.128-.127.32-.212.53-.212h3.47c.298 0 .51.064.827.91l.042.127c.04.17.19.445.72.445.316 0 .824-.085 1.438-.254.57-.17 1.058-.635 1.29-1.207.234-.593.17-1.228-.19-1.757-.846-1.334-2.264-2.2-3.936-2.37 0-.128-.02-.297-.02-.51 0-.845-.87-1.523-1.97-1.523s-1.968.657-1.968 1.524c0 .19 0 .36-.02.487-2.668.128-4.572 2.117-4.572 4.848v.804c0 2.137 1.333 4 3.238 4.508l5.354 1.46c.254.064.423.318.423.635v.466c0 .19 0 .7-.232.932-.127.148-.318.21-.487.21h-3.47c-.276 0-.403-.083-.488-.19-.233-.232-.317-.613-.38-.867-.064-.19-.234-.444-.763-.444-.338 0-.846.086-1.418.234-.572.148-1.038.592-1.292 1.164-.254.592-.19 1.248.127 1.8.868 1.46 2.307 2.348 3.916 2.432v.487c0 .445.233.847.636 1.143.36.254.825.38 1.333.38h.02c1.1 0 1.968-.676 1.968-1.523v-.508c2.603-.212 4.593-2.37 4.593-5.1v-.636c.022-2.2-1.48-4.085-3.618-4.614zm7.704 10.54H83.98v-4.19H31.555z"
            />
        </svg>
    </div>
</div>
<div class="pie pie2" onclick="document.body.classList.remove('active')">
    <div class="pie-color pie-color2">
        <svg class="discount" xmlns="http://www.w3.org/2000/svg" viewBox="-375 377 100 100" width="100" height="100">
            <path
                    fill="#fff"
                    d="M-311.266 425.624c-.106 0-.212 0-.34.022-1.057.127-1.755.783-2.115 2.01-.318 1.1-.36 2.645-.128 4.57.19 1.567.783 6.307 3.407 6.307.105 0 .21 0 .317-.02 1.947-.234 2.603-2.37 2.074-6.667-.507-4.317-1.502-6.222-3.216-6.222zm-28.166-9.967c-.106 0-.212 0-.34.02-.634.086-1.12.34-1.5.827-.784 1.016-1.038 3.005-.7 5.756.508 4.21 1.61 6.242 3.365 6.242.106 0 .19 0 .296-.02 1.12-.128 1.798-.868 2.094-2.265.297-1.397.148-3.153 0-4.36-.508-4.274-1.502-6.2-3.216-6.2zm63.654 10.306l-12.887-7.13c-1.037-.573-1.397-1.885-.783-2.9l7.597-12.613c.613-1.016.147-1.84-1.06-1.82l-14.728.275c-1.185.02-2.137-.93-2.116-2.116l.275-14.73c.022-1.206-.782-1.67-1.82-1.058l-12.61 7.576c-1.017.614-2.33.275-2.9-.783l-7.132-12.887c-.57-1.037-1.524-1.037-2.095 0l-7.13 12.887c-.573 1.037-1.885 1.397-2.9.783l-12.634-7.597c-1.017-.613-1.842-.147-1.82 1.06l.274 14.728c.02 1.185-.93 2.137-2.116 2.116l-14.73-.275c-1.184-.022-1.67.782-1.057 1.82l7.598 12.61c.614 1.017.275 2.33-.783 2.9l-12.887 7.132c-1.037.57-1.037 1.524 0 2.095l12.887 7.13c1.037.573 1.397 1.885.783 2.9l-7.597 12.634c-.613 1.017-.147 1.842 1.06 1.82l14.728-.274c1.185-.02 2.137.93 2.116 2.116l-.275 14.73c-.022 1.205.782 1.67 1.82 1.057l12.61-7.598c1.017-.614 2.33-.275 2.9.783l7.132 12.887c.57 1.037 1.524 1.037 2.095 0l7.13-12.887c.573-1.037 1.885-1.397 2.9-.783l12.613 7.597c1.016.613 1.84.147 1.82-1.06l-.275-14.728c-.02-1.185.93-2.137 2.116-2.116l14.73.275c1.185.022 1.67-.782 1.058-1.82l-7.597-12.61c-.613-1.017-.274-2.33.784-2.9l12.887-7.132c1.06-.592 1.06-1.524.022-2.095zm-62.067 8.19c-.402.042-.783.063-1.185.063-1.905 0-3.577-.592-5.08-1.82-3.11-2.54-3.935-6.2-4.337-9.46-.487-4.04.148-7.28 1.947-9.65 1.523-1.967 3.66-3.173 6.137-3.47.36-.042.72-.063 1.1-.063 2.73 0 5.185 1.27 6.9 3.555 1.395 1.82 2.22 4.17 2.623 7.407.444 3.64 0 6.772-1.29 9.078-1.398 2.476-3.747 3.98-6.815 4.36zm8.634 10.686c-.192.486-.72 1.82-2.308 2.01-.084.02-.17.02-.275.02-1.12 0-2.412-.655-2.582-2.115-.084-.72.148-1.355.36-1.82l13.184-33.817c.36-.762.803-1.777 2.263-1.947.106-.02.212-.02.318-.02 1.122 0 2.307.677 2.498 2.18.084.656-.064 1.08-.233 1.502zm26.345-5.08c-1.396 2.498-3.767 4.02-6.856 4.402-.424.043-.826.085-1.23.085-1.882 0-3.533-.593-5.056-1.82-3.11-2.518-3.936-6.222-4.338-9.502-.487-4.042.17-7.3 1.946-9.65 1.545-1.968 3.66-3.174 6.137-3.47.36-.042.74-.063 1.12-.063 1.948 0 4.74.613 6.92 3.555 1.398 1.82 2.223 4.19 2.625 7.406.444 3.598 0 6.75-1.27 9.058z"
            />
        </svg>
    </div>
</div>
<div class="pie pie3" onclick="document.body.classList.remove('active')">
    <div class="pie-color pie-color3">
        <svg class="cart" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100">
            <path
                    d="M98.993 14.537c-.816-.966-2.018-1.503-3.263-1.503H25.698c-.064 0-.107.022-.172.022l-9.36-9.404c-.816-.794-1.91-1.245-3.05-1.245H4.295C1.932 2.407 0 4.34 0 6.7c0 2.363 1.932 4.295 4.294 4.295h7.063l7.73 7.728 9.574 56.893c.344 2.06 2.148 3.585 4.23 3.585h50.388c2.36 0 4.293-1.93 4.293-4.293 0-2.36-1.93-4.293-4.292-4.293h-46.76l-1.588-9.447h54.423c2.104 0 3.908-1.524 4.23-3.606l6.354-39.545c.215-1.267-.128-2.533-.944-3.478zm-60.177 38.02H33.49L31.56 41.03h7.256zm0-20.115H30.1L28.273 21.6h10.542zm16.38 20.116h-7.793V41.03h7.793zm0-20.116h-7.793V21.6h7.793zm16.38 20.116h-7.792V41.03h7.793zm0-20.116h-7.792V21.6h7.793zm14.128 20.116h-5.54V41.03h7.386zm3.22-20.116h-8.78V21.6h10.52zm-47.618 50.13c-4.143 0-7.514 3.37-7.514 7.514 0 4.143 3.37 7.514 7.514 7.514s7.514-3.37 7.514-7.514-3.37-7.514-7.514-7.514zm34.758 0c-4.143 0-7.514 3.37-7.514 7.514 0 4.143 3.37 7.514 7.514 7.514 4.165 0 7.514-3.37 7.514-7.514s-3.35-7.514-7.514-7.514z"
            />
        </svg>
    </div>
</div>
<div class="menu" onclick="document.body.classList.toggle('active')">
    <svg class="hamburger" xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100">
        <g
                fill="none"
                stroke="#000"
                stroke-width="7.999"
                stroke-linecap="round"
        >
            <path d="M 55,26.000284 L 24.056276,25.999716" />
            <path d="M 24.056276,49.999716 L 75.943724,50.000284" />
            <path d="M 45,73.999716 L 75.943724,74.000284" />
            <path d="M 75.943724,26.000284 L 45,25.999716" />
            <path d="M 24.056276,73.999716 L 55,74.000284" />
        </g>
    </svg>
</div>
</body>
<script>
    /**
     * Global variables
     */
    class Profile {
        constructor(params) {
            this.name = params.name;
            this.firebaseConfig = params.firebaseConfig;
            this.weatherLoc = params.weatherLoc;
            this.clockLoc = params.clockLoc;
            this.twitterLoc = params.twitterLoc;
            this.healthStepLoc = params.healthStepLoc;
            this.healthSleepLoc = params.healthSleepLoc;
            this.welcomeLoc = params.welcomeLoc;
            this.googleEventLoc = params.googleEventLoc;
            this.apiKey = params.googleAPIkey;
            this.clientId = params.googleclientId;
            this.discoveryDocs = params.googlediscoveryDocs;
            this.scope = params.googlescope;
            this.twAccount = params.twitterSpec.account;
            this.twLimit = params.twitterSpec.limit;
            this.isReady = false;
            this.twitterData = [];
            this.healthkitStepData =[];
            this.healthkitSleepData =[];
            this.healthkitWalkingData =[];
            this.loadWeatherData = this.loadWeatherData.bind(this)
            this.loadTwitterData = this.loadTwitterData.bind(this)
            this.loadGoogleEvent = this.loadGoogleEvent.bind(this)
            this.loadHealthKitData = this.loadHealthKitData.bind(this)

        }

        init() {

            this.loadWeatherData();
            this.loadTwitterData();
            this.loadClockData();
            this.loadGoogleEvent();
            this.loadHealthKitData();
            this.loadYouTubeVideo()

        }

        showData() {
            this.displayWeather();
            this.displayTwitter();
            this.displayClock();
            this.displayGoogleEvents();
            this.displayHealthKit();
            // this.displayYouTubeVideo();
        }
        loadGoogleEvent(){
            let _this = this;
            _this.btnAuthorizationSignIn = createButton('Sign in');
            _this.btnAuthorizationSignIn.position(this.welcomeLoc.x + 120, this.welcomeLoc.y-15)

            _this.btnAuthorizationSignIn.hide()
            _this.btnAuthorizationSignOut = createButton('Sign out');

            _this.btnAuthorizationSignOut.position(this.welcomeLoc.x + 120, this.welcomeLoc.y-15)
            _this.btnAuthorizationSignOut.hide()
            jQuery.loadScript = function (url, callback) {
                jQuery.ajax({
                    url: url,
                    dataType: 'script',
                    success: callback,
                    async: true
                });
            }
            $.loadScript('https://apis.google.com/js/api.js', function(){
                gapi.load('client:auth2', function () {
                    gapi.client.init({
                        apiKey: _this.apiKey,
                        clientId: _this.clientId,
                        discoveryDocs: _this.discoveryDocs,
                        scope: _this.scope
                    }).then(function () {

                         gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
                        //
                        // // Handle the initial sign-in state.
                        updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
                        _this.btnAuthorizationSignIn.mousePressed(handleAuthClick);
                        _this.btnAuthorizationSignOut.mousePressed(handleSignoutClick)
                    }, function(error) {
                        appendPre(JSON.stringify(error, null, 2));
                    });
                });
            });
            function listUpcomingEvents() {
                _this.eventList = [];

                gapi.client.calendar.events.list({
                    'calendarId': 'primary',
                    'timeMin': (new Date()).toISOString(),
                    'showDeleted': false,
                    'singleEvents': true,
                    'maxResults': 10,
                    'orderBy': 'startTime'
                }).then(function(response) {
                    _this.name = response.result.summary;
                    var events = response.result.items;
                    if (events.length > 0) {
                        for (let i = 0; i < events.length; i++) {
                            var event = events[i];

                            var when =  event.start.dateTime.slice(11,16)+'-'+event.end.dateTime.slice(11,16);
                            if (!when) {
                                when = event.start.date;
                            }

                            _this.eventList.push(event.summary + ' (' + when + ')')
                        }
                    }
                });
            }
            function handleSignoutClick(event) {
                gapi.auth2.getAuthInstance().signOut();
                _this.name ="Anonymous"
            }
            function updateSigninStatus(isSignedIn) {
                if(isSignedIn){
                    _this.btnAuthorizationSignOut.show();
                    _this.btnAuthorizationSignIn.hide()
                    listUpcomingEvents();
                }else{
                    _this.btnAuthorizationSignIn.show();
                    _this.btnAuthorizationSignOut.hide()
                }

            }
            function handleAuthClick(event) {
                gapi.auth2.getAuthInstance().signIn();
                _this.btnAuthorizationSignOut.show();
                _this.btnAuthorizationSignIn.hide()

            }
        }
        loadTwitterData() {
            let _this = this;
            twttr.widgets.createTimeline(
                {
                    sourceType: 'profile',
                    screenName: _this.twAccount,

                },
                document.getElementById('timeline'),
                {
                    width: '150',
                    height: '700',
                    tweetLimit: _this.twLimit,
                }).then(function (el) {
                var tweets = el.contentWindow.document.getElementsByClassName('timeline-TweetList-tweet customisable-border')
                _this.twitterData.push({
                    imgUrl: loadImage(tweets[0].getElementsByClassName('Avatar')[0].getAttribute('data-src-2x')),
                    text: "@" + _this.twAccount
                })
                for (let item of tweets) {
                    let avatar = item.getElementsByClassName('Avatar')[0].getAttribute('data-src-2x');
                    let avatarImg = loadImage(avatar);
                    let tweetText = item.getElementsByClassName('timeline-Tweet-text')[0].innerText;
                    _this.twitterData.push({imgUrl: avatarImg, text: tweetText})

                }

            });
        }
        loadHealthKitData(){
            let _this = this;
            firebase.initializeApp(this.firebaseConfig);
            firebase.analytics();

            let	parseDate = d3.time.format("%d-%b-%Y").parse;
            let rootNode = firebase.database().ref()
            let stepCount = rootNode.child("huyen-stepCounts");
            let sleep = rootNode.child("huyen-sleep");
            let walkingDistance = rootNode.child("huyen-walkingDistance");

            stepCount.once("value",function (wholeTree) {
                barchartStep(wholeTree)
            })

            sleep.once('value',function (wholeTree) {
                piechartSleep(wholeTree)
            })

            walkingDistance.once("value",function (wholeTree) {
                linechartWalking(wholeTree)
            })


        }
        loadYouTubeVideo(){
           var video = createVideo(['videos/mov_bbb.mp4'], function () {
               video.play()
               video.volume(0.8);
               video.style("z-index",100)
               video.size(200, 150);
               video.position(window.innerWidth - 250, window.innerHeight - 380)
           });

        }
        shakenWeatherBox() {
            this.weatherLoc.tempX = this.weatherLoc.x + random(-1, 1)
            this.weatherLoc.tempY = this.weatherLoc.y + random(-1, 1)
        }

        shakenTwitterBox() {
            this.twitterLoc.tempX = this.twitterLoc.x + random(-1, 1)
            this.twitterLoc.tempY = this.twitterLoc.y + random(-1, 1)
        }

        shakenHealthStepBox(){
            this.healthStepLoc.tempX = this.healthStepLoc.x + random(-1, 1)
            this.healthStepLoc.tempY = this.healthStepLoc.y + random(-1, 1)
        }
        shakenGoogleEventBox(){
            this.googleEventLoc.tempX = this.googleEventLoc.x + random(-1, 1)
            this.googleEventLoc.tempY = this.googleEventLoc.y + random(-1, 1)
        }

        shakenClockBox() {
            this.clockLoc.tempX = this.clockLoc.x + random(-1, 1)
            this.clockLoc.tempY = this.clockLoc.y + random(-1, 1)
        }

        loadWeatherData() {
            let _this = this;
            loadJSON("http://api.openweathermap.org/data/2.5/weather?zip=79415,us&APPID=110d9b8e28093bca1255c95aa342c445&units=metric", function (data) {
                _this.weatherData = data;
                _this.weatherIcon = loadImage(`http://openweathermap.org/img/wn/${_this.weatherData.weather[0].icon}@2x.png`);
                _this.isReady = true;
            });
        }

        loadClockData() {
            let dayofWeeks =
                ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
            this.monthInText = [`January`, `February`, `March`, `April`, `May`, `June`, `July`, `August`, `September`, `October`, `November`, `December`]
            let _today = new Date();
            let today = _today.getDay()
            this.today = dayofWeeks[today];
        }

        displayWeather() {
            noStroke();
            this.weatherLoc.active === true ? fill("#808080") : noFill();
            rect(this.weatherLoc.tempX, this.weatherLoc.tempY-10, this.weatherLoc.w, this.weatherLoc.h);

            image(this.weatherIcon, this.weatherLoc.tempX, this.weatherLoc.tempY, 50, 50);


            fill(this.weatherLoc.color);
            textSize(18);
            text(this.weatherData.main.temp + "°", this.weatherLoc.tempX + 40, this.weatherLoc.tempY + 10);
            fill(255);
            textSize(14);
            textStyle(BOLD);
            fill(255, 255, 0)
            text('C', this.weatherLoc.tempX + 110, this.weatherLoc.tempY + 5);

            textStyle(NORMAL);
            fill(255);
            text(' | F', this.weatherLoc.tempX + 120, this.weatherLoc.tempY + 5);
            fill(255);
            textSize(14);
            text(`${this.weatherData.main.temp_max}° / ${this.weatherData.main.temp_min}°`, this.weatherLoc.tempX + 50, this.weatherLoc.tempY + 25);
            fill(255);
            text(`Humidity: ${this.weatherData.main.humidity}%`, this.weatherLoc.tempX + 50, this.weatherLoc.tempY + 40);


        }

        displayClock() {
            textSize(30);
            text(`${hour()}:${minute()}`, this.clockLoc.tempX, this.clockLoc.tempY);

            fill(255);
            textSize(14);
            text(`${this.today} ${day()}, ${this.monthInText[month() - 1]}, ${year()} `, this.clockLoc.tempX - 50,
                this.clockLoc.tempY + 20);

        }
        displayGoogleEvents(){
            text(`Hello: ${this.name} `,this.welcomeLoc.x-60, this.welcomeLoc.y);

            fill(152, 229, 152, 150);
            strokeWeight(0);
            rect(this.googleEventLoc.tempX-10, this.googleEventLoc.tempY - 15, 200, 25, 9);

            if(this.eventList !=null && this.eventList.length >0){
                textSize(14);
                fill(255);
                text(`Upcoming Events`, this.googleEventLoc.tempX, this.googleEventLoc.tempY -40);
                this.eventList.forEach((evt,i)=>{
                    if (i){
                        textSize(14);
                        fill(255);
                        stroke(60);
                        strokeWeight(1);
                        text(`${evt} `, this.googleEventLoc.tempX, this.googleEventLoc.tempY+i*25);
                    }
                    else {
                        textSize(14);
                        fill(0);
                        stroke(60);
                        strokeWeight(1);
                        text(`${evt} `, this.googleEventLoc.tempX, this.googleEventLoc.tempY+i*25);
                    }

                })
            }

        }
        displayTwitter() {
            if (this.twitterData.length > 0) {
                this.twitterData.forEach((tweet, index) => {
                    image(tweet.imgUrl, this.twitterLoc.tempX + 10, this.twitterLoc.tempY + index * 60, 50, 50);
                    text(tweet.text, this.twitterLoc.tempX + 70, this.twitterLoc.tempY + index * 60, this.twitterLoc.w, this.twitterLoc.h);
                })
            }
        }
        displayYouTubeVideo(){

        }
        displayHealthKit() {
            if(this.healthkitStepData.length > 0){
                this.healthkitStepData.forEach((evt,i)=>{
                    textSize(14);
                    rect(this.healthStepLoc.tempX + (i*15), this.healthStepLoc.tempY - evt.value/100, 10, evt.value/100)
                    fill(255);
                    text("Step Counts", this.healthStepLoc.tempX, this.healthStepLoc.tempY + 20)
                })
            }

        }
    }

    var WEBCAM, CANVAS, CURRENTPROFILE, counter = 0, isDraggable = false, btnMove, dragging = false, btnBrighness,
        slider, sliderVisible = false;
    const params = {

        vinhProfile: {
            firebaseConfig: {
                apiKey: "AIzaSyCeFJpmiOFaStW7l-LzKW08ADjHEJtcQ-E",
                authDomain: "healthkitfirebase.firebaseapp.com",
                databaseURL: "https://healthkitfirebase.firebaseio.com",
                projectId: "healthkitfirebase",
                storageBucket: "healthkitfirebase.appspot.com",
                messagingSenderId: "189248516188",
                appId: "1:189248516188:web:f7962b4204ec3f84b17699",
                measurementId: "G-PXCL7HQGJW"
            },
            name: "Vinh T. Nguyen",
            twitterSpec: {
                account:  "huyendoesstuff",
                limit: 4,
            },

            weatherLoc: {
                x: 190,
                y: 30,
                tempX: 190,
                tempY: 30,
                w: 150,
                h: 100,
                color: '#FFF'
            },
            clockLoc: {
                x: window.innerWidth / 2,
                y: 30,
                w: 200,
                h: 200,
                tempX: window.innerWidth / 2,
                tempY: 50,
                color: '#FFF'
            },
            twitterLoc: {
                x: 10,
                y: 200,
                w: 250,
                h: 350,
                tempX: 10,
                tempY: 200,
                color: '#FFF'
            },
            healthStepLoc: {
                x: 400,
                y: window.innerHeight - 100,
                w: 300,
                h: 100,
                tempX:400,
                tempY: window.innerHeight - 100,
            },
            healthSleepLoc: {
                x: 600,
                y: window.innerHeight - 100,
                w: 300,
                h: 100,
                tempX:600,
                tempY: window.innerHeight - 100,
            },
            welcomeLoc: {
                x: window.innerWidth - 200,
                y: 30,
                w: 150,
                h: 100,
            },
            googleEventLoc:{
                x: window.innerWidth - 300,
                y: 150,
                tempX: window.innerWidth - 300,
                tempY: 150,
                w: 200,
                h: 400,
                color: '#FFF'
            },
            googleAPIkey: "AIzaSyCtJzTr3KTtbMPC3Aa9uCOOsKnw5Zw44rg",
            googleclientId: '470126462623-4fuglh8aupd7q6i815vs60q3u6ebl7rj.apps.googleusercontent.com',
            googlediscoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],
            googlescope: "https://www.googleapis.com/auth/calendar.readonly"
        },
        huyenProfile: {
            firebaseConfig: {
                apiKey: "AIzaSyCeFJpmiOFaStW7l-LzKW08ADjHEJtcQ-E",
                authDomain: "healthkitfirebase.firebaseapp.com",
                databaseURL: "https://healthkitfirebase.firebaseio.com",
                projectId: "healthkitfirebase",
                storageBucket: "healthkitfirebase.appspot.com",
                messagingSenderId: "189248516188",
                appId: "1:189248516188:web:f7962b4204ec3f84b17699",
                measurementId: "G-PXCL7HQGJW"
            },
            name: "Huyen Nguyen",
            twitterSpec: {
                account:  "huyendoesstuff",
                limit: 8,
            },
            weatherLoc: {
                x: 950,
                y: 400,
                tempX: 3 * window.innerWidth / 4,
                tempY: 40,
                w: 150,
                h: 100,
                color: '#f4a9dc'
            },
            clockLoc: {
                x: window.innerWidth / 2,
                y: 30,
                w: 200,
                h: 200,
                tempX: window.innerWidth / 4,
                tempY: 50,
                color: '#FFF'
            },
            twitterLoc: {
                x: 10,
                y: 150,
                w: 250,
                h: 350,
                tempX: window.innerWidth - 400,
                tempY: 150,
                color: '#FFF'
            },
            healthLoc: {
                x: 10,
                y: window.innerHeight - 200,
                w: 150,
                h: 50,
            },
            welcomeLoc: {
                x: window.innerWidth - 400,
                y: 30,
                w: 150,
                h: 100,
            },
            googleAPIkey: "AIzaSyCR8FuCOVFEMRdr-ain13oH_VX69qcbvaI",
            googleclientId: '470126462623-4fuglh8aupd7q6i815vs60q3u6ebl7rj.apps.googleusercontent.com',
            googlediscoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],
            googlescope: "https://www.googleapis.com/auth/calendar.readonly"
        },
        linhProfile: {
            name: "Linh Ho Manh",
            twitterSpec: {
                account:  "linhhomanh",
                limit: 4,
            },
            weatherLoc: {
                x: 150,
                y: 30,
                tempX: 150,
                tempY: window.innerHeight,
                w: 150,
                h: 100,
                color: '#FFF'
            },
            clockLoc: {
                x: window.innerWidth / 2,
                y: 30,
                w: 200,
                h: 200,
                tempX: window.innerWidth / 2,
                tempY: window.innerHeight - 100,
                color: '#FFF'
            },
            twitterLoc: {
                x: 10,
                y: 150,
                w: 250,
                h: 350,
                tempX: 10,
                tempY: 550,
                color: '#FFF'
            },
            healthLoc: {
                x: 10,
                y: window.innerHeight - 100,
                w: 150,
                h: 50,
            },
            welcomeLoc: {
                x: window.innerWidth - 200,
                y: 30,
                w: 150,
                h: 100,
            },
            googleAPIkey: "AIzaSyCtJzTr3KTtbMPC3Aa9uCOOsKnw5Zw44rg",
            googleclientId: '470126462623-4fuglh8aupd7q6i815vs60q3u6ebl7rj.apps.googleusercontent.com',
            googlediscoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"],
            googlescope: "https://www.googleapis.com/auth/calendar.readonly"
        }
    };

    /**
     * Setup control and parameters
     */
    function preload() {
        CURRENTPROFILE = new Profile(params.vinhProfile)
        CURRENTPROFILE.init()
    }

    function setup() {
        CANVAS = createCanvas(windowWidth, windowHeight);
        CANVAS.style("z-index",-1)
        btnMove = createButton('Done');
        btnMove.position(width - 70, 50);
        btnMove.mousePressed(btnMoveMousePressed)
        btnMove.hide();
        btnBrighness = createButton('Brighness')
        btnBrighness.position(19, height - 60)
        btnBrighness.style("background-color", "#000");
        btnBrighness.style("color", "#fff");
        btnBrighness.size(100, 40)
        btnBrighness.mousePressed(btnBrighnessMousePressed)
        slider = createSlider(0, 255, 200);
        slider.position(19, height - 90);
        slider.style('width', '100px');
        slider.hide()
        WEBCAM = createCapture(VIDEO);
        WEBCAM.id('inputVideo')
        WEBCAM.loop();
        WEBCAM.hide();
        CANVAS.position(0, 0);

    }

    function draw() {
        let val = slider.value();
        tint(val); // Display at half opacity
        image(WEBCAM, 0, 0, width, height);
        if (mouseIsPressed) {
            counter++
        }
        if (counter > 120) {
            isDraggable = true;

            btnMove.show()

        }
        if (CURRENTPROFILE.isReady) {
            if (isDraggable && !dragging) {
                CURRENTPROFILE.shakenWeatherBox();
                CURRENTPROFILE.shakenTwitterBox();
                CURRENTPROFILE.shakenClockBox();
                CURRENTPROFILE.shakenGoogleEventBox();
                CURRENTPROFILE.shakenHealthStepBox();
            }
            CURRENTPROFILE.showData()
        }
    }

    /**
     * Interaction control section and parameters
     * @param event
     */
    function btnBrighnessMousePressed() {

        sliderVisible = !sliderVisible;
        sliderVisible === true ? slider.show() : slider.hide()
        let c = sliderVisible === true ? "#00f" : "#000";
        btnBrighness.style("background-color", c);
        btnBrighness.style("color", "#fff");
    }

    function mouseDragged(event) {
        cursor(MOVE);
        if (isDraggable) {
            if (CURRENTPROFILE.weatherLoc.active === true) {
                CURRENTPROFILE.weatherLoc.tempX = mouseX;
                CURRENTPROFILE.weatherLoc.tempY = mouseY;
            }

            if (CURRENTPROFILE.twitterLoc.active === true) {
                CURRENTPROFILE.twitterLoc.tempX = mouseX;
                CURRENTPROFILE.twitterLoc.tempY = mouseY;
            }

            if (CURRENTPROFILE.clockLoc.active === true) {
                CURRENTPROFILE.clockLoc.tempX = mouseX;
                CURRENTPROFILE.clockLoc.tempY = mouseY;
            }

            if (CURRENTPROFILE.googleEventLoc.active === true) {
                CURRENTPROFILE.googleEventLoc.tempX = mouseX;
                CURRENTPROFILE.googleEventLoc.tempY = mouseY;
            }

            if (CURRENTPROFILE.healthStepLoc.active === true) {
                CURRENTPROFILE.healthStepLoc.tempX = mouseX;
                CURRENTPROFILE.healthStepLoc.tempY = mouseY;
            }
            return false;
        }
    }

    function mousePressed() {
        cursor(MOVE);
        dragging = true;
        if (isDraggable) {
            // Check if weatherbox is clicked
            if (mouseX > CURRENTPROFILE.weatherLoc.tempX && mouseX < CURRENTPROFILE.weatherLoc.tempX + CURRENTPROFILE.weatherLoc.w && mouseY > CURRENTPROFILE.weatherLoc.tempY && mouseY < CURRENTPROFILE.weatherLoc.tempY + CURRENTPROFILE.weatherLoc.h) {
                CURRENTPROFILE.weatherLoc.active = true;
                CURRENTPROFILE.weatherLoc.color = '#f00'
            } else {
                CURRENTPROFILE.weatherLoc.x = CURRENTPROFILE.weatherLoc.tempX;
                CURRENTPROFILE.weatherLoc.y = CURRENTPROFILE.weatherLoc.tempY;
                CURRENTPROFILE.weatherLoc.active = false;
                CURRENTPROFILE.weatherLoc.color = 'blue'
            }

            if (mouseX > CURRENTPROFILE.twitterLoc.tempX && mouseX < CURRENTPROFILE.twitterLoc.tempX + CURRENTPROFILE.twitterLoc.w && mouseY > CURRENTPROFILE.twitterLoc.tempY && mouseY < CURRENTPROFILE.twitterLoc.tempY + CURRENTPROFILE.twitterLoc.h) {
                CURRENTPROFILE.twitterLoc.active = true;
                CURRENTPROFILE.twitterLoc.color = '#f00'
            } else {
                CURRENTPROFILE.twitterLoc.x = CURRENTPROFILE.twitterLoc.tempX;
                CURRENTPROFILE.twitterLoc.y = CURRENTPROFILE.twitterLoc.tempY;
                CURRENTPROFILE.twitterLoc.active = false;
                CURRENTPROFILE.twitterLoc.color = 'blue'
            }

            if (mouseX > CURRENTPROFILE.clockLoc.tempX && mouseX < CURRENTPROFILE.clockLoc.tempX + CURRENTPROFILE.clockLoc.w && mouseY > CURRENTPROFILE.clockLoc.tempY && mouseY < CURRENTPROFILE.clockLoc.tempY + CURRENTPROFILE.clockLoc.h) {
                CURRENTPROFILE.clockLoc.active = true;
                CURRENTPROFILE.clockLoc.color = '#f00'
            } else {
                CURRENTPROFILE.clockLoc.x = CURRENTPROFILE.clockLoc.tempX;
                CURRENTPROFILE.clockLoc.y = CURRENTPROFILE.clockLoc.tempY;
                CURRENTPROFILE.clockLoc.active = false;
                CURRENTPROFILE.clockLoc.color = 'blue'
            }

            if (mouseX > CURRENTPROFILE.googleEventLoc.tempX && mouseX < CURRENTPROFILE.googleEventLoc.tempX + CURRENTPROFILE.googleEventLoc.w && mouseY > CURRENTPROFILE.googleEventLoc.tempY && mouseY < CURRENTPROFILE.googleEventLoc.tempY + CURRENTPROFILE.googleEventLoc.h) {
                CURRENTPROFILE.googleEventLoc.active = true;
                CURRENTPROFILE.googleEventLoc.color = '#f00'
            } else {
                CURRENTPROFILE.googleEventLoc.x = CURRENTPROFILE.googleEventLoc.tempX;
                CURRENTPROFILE.googleEventLoc.y = CURRENTPROFILE.googleEventLoc.tempY;
                CURRENTPROFILE.googleEventLoc.active = false;
                CURRENTPROFILE.googleEventLoc.color = 'blue'
            }

            if (mouseX > CURRENTPROFILE.healthStepLoc.tempX && mouseX < CURRENTPROFILE.healthStepLoc.tempX + CURRENTPROFILE.healthStepLoc.w && mouseY > CURRENTPROFILE.healthStepLoc.tempY && mouseY < CURRENTPROFILE.healthStepLoc.tempY + CURRENTPROFILE.healthStepLoc.h) {
                CURRENTPROFILE.healthStepLoc.active = true;
                CURRENTPROFILE.healthStepLoc.color = '#f00'
            } else {
                CURRENTPROFILE.healthStepLoc.x = CURRENTPROFILE.healthStepLoc.tempX;
                CURRENTPROFILE.healthStepLoc.y = CURRENTPROFILE.healthStepLoc.tempY;
                CURRENTPROFILE.healthStepLoc.active = false;
                CURRENTPROFILE.healthStepLoc.color = 'blue'
            }
            return false;
        }
    }

    function mouseReleased() {
        counter = 0;
        cursor(ARROW);
        dragging = false;
        CURRENTPROFILE.weatherLoc.x = CURRENTPROFILE.weatherLoc.tempX;
        CURRENTPROFILE.weatherLoc.y = CURRENTPROFILE.weatherLoc.tempY;

        CURRENTPROFILE.twitterLoc.x = CURRENTPROFILE.twitterLoc.tempX;
        CURRENTPROFILE.twitterLoc.y = CURRENTPROFILE.twitterLoc.tempY;

        CURRENTPROFILE.clockLoc.x = CURRENTPROFILE.clockLoc.tempX;
        CURRENTPROFILE.clockLoc.y = CURRENTPROFILE.clockLoc.tempY;

        CURRENTPROFILE.googleEventLoc.x = CURRENTPROFILE.googleEventLoc.tempX;
        CURRENTPROFILE.googleEventLoc.y = CURRENTPROFILE.googleEventLoc.tempY;

        CURRENTPROFILE.healthStepLoc.x = CURRENTPROFILE.healthStepLoc.tempX;
        CURRENTPROFILE.healthStepLoc.y = CURRENTPROFILE.healthStepLoc.tempY;
    }

    function btnMoveMousePressed() {
        isDraggable = false;
        btnMove.hide()
    }

    function barchartSleep(wholeTree) {
        console.log(wholeTree)

// Parse the date / time
        let	parseDate = d3.time.format("%d-%b-%Y").parse;
        let count = 0;
        let data = [];
        wholeTree.forEach(item=>{
            data.push({date:parseDate(item.key), value:+item.val()/(60*60)});
            count += 1;
        });
        data = data.sort(function (a,b) {
            return a.date - b.date
        })

        console.log(data)

        let margin = {top: 20, right: 20, bottom: 70, left: 40},
            width = 50*count - margin.left - margin.right,
            height = 200 - margin.top - margin.bottom;

        let x = d3.scale.ordinal().rangeRoundBands([0, width], .05);

        let y = d3.scale.linear().range([height, 0]);

        let xAxis = d3.svg.axis()
            .scale(x)
            .orient("bottom")
            .tickFormat(d3.time.format("%d-%m"));

        let yAxis = d3.svg.axis()
            .scale(y)
            .orient("left")
            .ticks(10);

        let svg = d3.select("body").append("svg")

            .attr("id",'sleep')
            .attr("class", "sleepchart")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        x.domain(data.map(function(d) { return d.date; }));
        y.domain([0, d3.max(data, function(d) { return d.value; })]);

        svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis)
            .selectAll("text")
            .style("text-anchor", "end")
            .attr('class','text')
            .attr("dx", "-.8em")
            .attr("dy", "-.55em")
            .attr("transform", "rotate(-90)" )
        ;

        svg.append("g")
            .attr("class", "y axis")
            .call(yAxis.ticks(5))
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 6)
            .attr("dy", ".71em")
            .style("text-anchor", "end")
            .text("Sleep (hours)");

        svg.selectAll("bar")
            .data(data)
            .enter().append("rect")
            .style("fill", "steelblue")
            .style('opacity',0.3)
            .attr("x", function(d) { return x(d.date); })
            .attr("width", x.rangeBand())
            .attr("y", function(d) { return y(d.value); })
            .attr("height", function(d) { return height - y(d.value); });
    }

    function barchartStep(wholeTree) {
        console.log(wholeTree)

// Parse the date / time
        let	parseDate = d3.time.format("%d-%b-%Y").parse;
        let count = 0;
        let data = [];
        wholeTree.forEach(item=>{
            data.push({date:parseDate(item.key), value:+item.val()});
            count += 1;
        });
        data = data.sort(function (a,b) {
            return a.date - b.date
        })

        console.log(data)

        let margin = {top: 20, right: 20, bottom: 70, left: 60},
            width = 50*count - margin.left - margin.right,
            height = 200 - margin.top - margin.bottom;

        let x = d3.scale.ordinal().rangeRoundBands([0, width], .05);

        let y = d3.scale.linear().range([height, 0]);

        let xAxis = d3.svg.axis()
            .scale(x)
            .orient("bottom")
            .tickFormat(d3.time.format("%a %d"))
        ;

        let yAxis = d3.svg.axis()
            .scale(y)
            .orient("left")
            .ticks(10);

        let svg = d3.select("body").append("svg")
            .attr("id",'sleep')
            .attr("class", "barchart-step")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        x.domain(data.map(function(d) { return d.date; }));
        y.domain([0, d3.max(data, function(d) { return d.value; })]);

        svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis)
            .selectAll("text")
            .style("text-anchor", "end")
            .attr('class','text')
            .attr("dx", "-.8em")
            .attr("dy", "-.55em")
            .attr("transform", "rotate(-90)" )
        ;



        svg.selectAll("bar")
            .data(data)
            .enter().append("rect")
            .style("fill", "steelblue")
            .style('opacity',0.5)
            .attr("x", function(d) { return x(d.date); })
            .attr("width", x.rangeBand())
            .attr("y", function(d) { return y(d.value); })
            .attr("height", function(d) { return height - y(d.value); });

        svg.append("g")
            .attr("class", "y axis")
            .call(yAxis.ticks(5))
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 6)
            .attr("dy", ".71em")
            .style("text-anchor", "end")
            .text("Step count ");
    }


    function piechartSleep(wholeTree) {
        // console.log(wholeTree)

// Parse the date / time
        let	parseDate = d3.time.format("%d-%b-%Y").parse;
        var format = d3.time.format("%a %d");
        let count = 0;
        let data = [];
        wholeTree.forEach(item=>{
            data.push({
                date:format(new Date(Date.parse(parseDate(item.key)))),
                value:+item.val()/(60*60)});
            count += 1;
        });
        data = data.sort(function (a,b) {
            return a.date - b.date
        })

        var width = 250,
            height = 150,
            height2 = 170,
            radius = Math.min(width, height) / 2;

        var svg = d3.select("body")
            .append("svg")
            .attr("width", width)
            .attr("height", height2)
            .attr("class", "piechart-sleep")
            .append("g")

        svg.append("g")
            .attr("class", "slices");
        svg.append("g")
            .attr("class", "labels");
        svg.append("g")
            .attr("class", "lines");



        var pie = d3.layout.pie()
            .sort(null)
            .value(function(d) {
                return d.value;
            });

        var arc = d3.svg.arc()
            .outerRadius(radius * 0.8)
            .innerRadius(radius * 0.4);

        var outerArc = d3.svg.arc()
            .innerRadius(radius * 0.9)
            .outerRadius(radius * 0.9);

        svg.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

        var key = function(d){ return d.data.date; };

        var color = d3.scale.ordinal()
            .domain(data.map(d => d.date))
            .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56"]);

        function randomData (){
            var labels = color.domain();
            console.log(labels)
            return labels.map(function(label){
                return { date: label, value: Math.random() }
            });
        }
        change(data);

        function change(data) {

            /* ------- PIE SLICES -------*/
            var slice = svg.select(".slices").selectAll("path.slice")
                .data(pie(data), key);

            slice.enter()
                .insert("path")
                .style("fill", function(d) { return color(d.data.date); })
                .style("opacity", 0.8)
                .attr("class", "slice");

            slice
                .transition().duration(1000)
                .attrTween("d", function(d) {
                    this._current = this._current || d;
                    var interpolate = d3.interpolate(this._current, d);
                    this._current = interpolate(0);
                    return function(t) {
                        return arc(interpolate(t));
                    };
                })

            slice.exit()
                .remove();

            /* ------- TEXT LABELS -------*/

            var text = svg.select(".labels").selectAll("text")
                .data(pie(data), key);

            text.enter()
                .append("text")
                .attr("dy", ".35em")
                .text(function(d) {
                    return d.data.date;
                });

            function midAngle(d){
                return d.startAngle + (d.endAngle - d.startAngle)/2;
            }

            text.transition().duration(1000)
                .attrTween("transform", function(d) {
                    this._current = this._current || d;
                    var interpolate = d3.interpolate(this._current, d);
                    this._current = interpolate(0);
                    return function(t) {
                        var d2 = interpolate(t);
                        var pos = outerArc.centroid(d2);
                        pos[0] = radius * (midAngle(d2) < Math.PI ? 1 : -1);
                        return "translate("+ pos +")";
                    };
                })
                .styleTween("text-anchor", function(d){
                    this._current = this._current || d;
                    var interpolate = d3.interpolate(this._current, d);
                    this._current = interpolate(0);
                    return function(t) {
                        var d2 = interpolate(t);
                        return midAngle(d2) < Math.PI ? "start":"end";
                    };
                });

            text.exit()
                .remove();

            /* ------- SLICE TO TEXT POLYLINES -------*/

            var polyline = svg.select(".lines").selectAll("polyline")
                .data(pie(data), key);

            polyline.enter()
                .append("polyline");

            polyline.transition().duration(1000)
                .attrTween("points", function(d){
                    this._current = this._current || d;
                    var interpolate = d3.interpolate(this._current, d);
                    this._current = interpolate(0);
                    return function(t) {
                        var d2 = interpolate(t);
                        var pos = outerArc.centroid(d2);
                        pos[0] = radius * 0.95 * (midAngle(d2) < Math.PI ? 1 : -1);
                        return [arc.centroid(d2), outerArc.centroid(d2), pos];
                    };
                });

            polyline.exit()
                .remove();

            svg.append("text")
                .attr("transform", "translate(-40,90)")
                .text("Sleep (hours)")
        };

    }

    function linechartWalking(wholeTree) {
        console.log(wholeTree)
// Parse the date / time

        let count = 0;
        var parseDate = d3.time.format("%d-%b-%Y").parse;
        let data = [];
        wholeTree.forEach(item=>{
            data.push({
                date:parseDate(item.key),
                value:+item.val()});

            count += 1;
        });
        data = data.sort(function (a,b) {
            return a.date - b.date
        })

        console.log(data)

        var margin = {top: 30, right: 20, bottom: 30, left: 50},
            width = 300 - margin.left - margin.right,
            height = 170 - margin.top - margin.bottom;


// Set the ranges
        var x = d3.time.scale().range([0, width]);
        var y = d3.scale.linear().range([height, 0]);

// Define the axes
        var xAxis = d3.svg.axis().scale(x)
            .orient("bottom").ticks(count);

        var yAxis = d3.svg.axis().scale(y)
            .orient("left").ticks(5);

// Define the line
        var valueline = d3.svg.line()
            .x(function(d) { return x(d.date); })
            .y(function(d) { return y(d.value); });

// Adds the svg canvas
        var svg = d3.select("body")
            .append("svg")
            .attr("class", "linechart")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        // Scale the range of the data
        x.domain(d3.extent(data, function(d) { return d.date; }));
        y.domain([0, d3.max(data, function(d) { return d.value; })]);

        // Add the valueline path.
        svg.append("path")
            .attr("class", "path-chart")
            .attr("d", valueline(data));

        // Add the X Axis
        svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis);

        // Add the Y Axis
        svg.append("g")
            .attr("class", "y axis")
            .call(yAxis)
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 6)
            .attr("dy", ".71em")
            .style("text-anchor", "end")
            .text("Walking (miles)");;


    }
</script>
</html>